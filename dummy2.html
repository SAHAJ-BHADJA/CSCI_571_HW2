<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Artist Search</title>
    <style>
      input[type="search"]::-webkit-search-cancel-button {
        display: none;
      }
      /* ----- Basic Resets ----- */
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }
      body {
        font-family: Arial, sans-serif;
        color: #333;
        display: flex;
        flex-direction: column;
      }
      /* ----- Header & Footer ----- */
      header {
        width: 100%;
        padding: 15px 20px;
        background-color: #ececec;
        border-bottom: 1px solid #ddd;
      }
      footer {
        width: 100%;
        padding: 13px;
        background-color: #112432;
        border-top: 1px solid #ddd;
        text-align: center;
        position: sticky;
        bottom: 0;
      }
      header h1 {
        font-size: 1.5rem;
        font-weight: normal;
        color: #000;
      }
      footer a {
        text-decoration: none;
        color: #fff;
        font-weight: bold;
        margin-left: 5px;
      }
      .footer-content {
        display: inline-flex;
        align-items: center;
        gap: 5px;
        color: #fff;
      }
      /* ----- Main Container ----- */
      main {
        min-height: calc(100vh - 110px); /* Reserve space for header & footer */
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: flex-start;
        padding: 20px;
        flex: 1;
      }
      /* ----- Search Container ----- */
      .search-container {
        display: flex;
        flex-direction: column;
        align-items: center;
        width: 100%;
        max-width: 600px;
      }
      #artist-form {
        position: relative;
        display: flex;
        align-items: center;
        width: 100%;
        border: 2px solid #ccc;
        border-radius: 30px;
        padding: 5px 10px;
        transition: border-color 0.2s ease;
        margin-bottom: 20px;
      }
      /* Highlight the border orange when any child is focused */
      #artist-form:focus-within {
        border-color: orange;
      }
      /* Icons */
      button.icon-btn {
        background: none;
        border: none;
        cursor: pointer;
        opacity: 0.5;
        display: flex;
        align-items: center;
        justify-content: center;
        height: 23px;
        width: 23px;
        margin-right: 5px;
        transition: opacity 0.2s;
      }
      button.icon-btn:focus {
        outline: none;
      }
      button.icon-btn:hover {
        opacity: 1;
      }
      #search-icon {
        background-image: url("/static/images/search_icon.png");
        background-size: contain;
        font-size: 1.1rem;
      }
      #clear-icon {
        background-image: url("/static/images/clear_icon.png");
        background-size: contain;
        font-size: 1.2rem;
      }
      /* Text Input */
      #artist-input {
        flex: 1;
        border: none;
        font-size: 1rem;
        padding: 5px 10px;
      }
      #artist-input:focus {
        outline: none;
      }
      /* ----- Results List Container ----- */
      #results-container {
        max-width: 800px;
        margin-top: 10px;
        display: flex;
        overflow-x: auto; /* horizontally scrollable */
        gap: 10px;
        padding-bottom: 10px;
        justify-content: center;
      }
      /* ----- Individual Result Card ----- */
      .result-card {
        /* Fixed width for uniform sizing */
        width: 180px;
        display: flex;
        flex-direction: column;
        align-items: center;
        background-color: #205375; /* original blue background */
        flex-shrink: 0;
        text-align: center;
        padding: 15px;
        cursor: pointer;
        transition: background-color 0.3s;
      }
      .result-card:hover {
        background-color: #112b3c; /* darker blue on hover */
      }
      /* When selected, stay darker blue */
      .result-card.selected {
        background-color: #112b3c;
      }
      /* Artist Image (circular with white border) */
      .artist-image {
        width: 160px;
        height: 160px;
        object-fit: cover;
        border: 2px solid #fff;
        border-radius: 50%;
        background-color: #fff;
      }
      /* Artist Name in Card */
      .artist-name {
        color: #fff;
        font-weight: bold;
        margin-top: 10px;
      }
      /* ----- No Results Found ----- */
      #no-results {
        display: none;
        margin-top: 20px;
        font-weight: bold;
        text-align: center;
        background-color: #c4c4c4;
        color: #333;
        padding: 15px;
        border-radius: 20px;
        font-size: 16px;
        width: 100%;
        margin-left: auto;
        margin-right: auto;
      }
      /* ----- Loading Indicator ----- */
      #loading {
        margin: 20px 0;
        display: none;
      }
      #loading img {
        width: 70px;
        height: auto;
      }
      /* ----- Artist Details Section ----- */
      #artist-details {
        max-width: 100%;
        margin: 20px auto;
        text-align: center;
        font-family: Arial, sans-serif;
      }
      /* Single line for name and dates together */
      #details-name {
        font-size: 18px;
        margin-bottom: 10px;
      }
      #details-nationality {
        font-size: 18px;
      }
      #details-bio {
        text-align: justify;
        font-size: 16px;
        max-width: 750px;
        margin: 0 auto;
      }
    </style>
  </head>
  <body>
    <header>
      <h1>Artist Search</h1>
    </header>

    <main>
      <div class="search-container">
        <!-- Form so that Enter key triggers submission -->
        <form id="artist-form">
          <!-- Magnifying glass icon (left) -->
          <button
            id="search-icon"
            class="icon-btn"
            type="submit"
            aria-label="Search"
          ></button>
          <!-- Input field -->
          <input
            id="artist-input"
            type="search"
            placeholder="Please enter an artist name."
            required
          />
          <!-- Clear (x) icon -->
          <button
            id="clear-icon"
            class="icon-btn"
            type="button"
            aria-label="Clear text"
          ></button>
        </form>

        <!-- "No results found" message -->
        <div id="no-results">No results found.</div>

        <!-- Search results (cards) -->
        <div id="results-container"></div>

        <!-- Loading indicator -->
        <div id="loading">
          <img src="/static/images/loading.gif" alt="Loading..." />
        </div>

        <!-- Artist details panel -->
        <div id="artist-details">
          <!-- Name & Dates in one line -->
          <p id="details-name"></p>
          <p id="details-nationality"></p>
          <p id="details-bio"></p>
        </div>
      </div>
    </main>

    <footer>
      <div class="footer-content">
        <a href="https://www.artsy.net">Powered by</a>
        <a href="https://www.artsy.net">
          <img
            src="/static/images/artsy_logo.svg"
            alt="Artsy Logo"
            style="height: 20px"
            onerror="this.style.display='none'"
          />
        </a>
        <a href="https://www.artsy.net">Artsy</a>
      </div>
    </footer>

    <script>
      const form = document.getElementById("artist-form");
      const input = document.getElementById("artist-input");
      const clearBtn = document.getElementById("clear-icon");
      const loading = document.getElementById("loading");
      const noResultsDiv = document.getElementById("no-results");
      const resultsContainer = document.getElementById("results-container");
      const detailsPanel = document.getElementById("artist-details");

      const detailsName = document.getElementById("details-name");
      const detailsNationality = document.getElementById("details-nationality");
      const detailsBio = document.getElementById("details-bio");

      let currentSelectedCard = null;

      // Clear text when the clear icon is clicked
      clearBtn.addEventListener("click", () => {
        input.value = "";
        input.focus();
      });

      // On form submit (Enter key or magnifying glass click)
      form.addEventListener("submit", (event) => {
        // Let the browser handle validation first
        if (!form.checkValidity()) {
          return; // Browser shows "Please fill out this field."
        }
        event.preventDefault();

        // Hide artist details (but keep existing result list and selection until new data arrives)
        detailsPanel.style.display = "none";

        // Show loading indicator and hide "No results found" message
        loading.style.display = "block";
        noResultsDiv.style.display = "none";

        const searchTerm = input.value.trim();
        fetch("/search?query=" + encodeURIComponent(searchTerm))
          .then((response) => response.json())
          .then((data) => {
            // Once new results arrive, clear the old result list and reset selection
            resultsContainer.innerHTML = "";
            currentSelectedCard = null;
            loading.style.display = "none";

            if (!data || data.length === 0) {
              noResultsDiv.style.display = "block";
              return;
            }

            // Process only the first 10 artists
            data.slice(0, 10).forEach((artist) => {
              const card = document.createElement("div");
              card.classList.add("result-card");
              card.setAttribute("data-artist-id", artist.id);

              const img = document.createElement("img");
              img.classList.add("artist-image");

              if (
                artist.thumbnail &&
                !artist.thumbnail.includes("/assets/shared/missing_image.png")
              ) {
                img.src = artist.thumbnail;
                img.onerror = () => {
                  img.src = "/static/images/artsy_logo.svg";
                };
              } else {
                img.src = "/static/images/artsy_logo.svg";
              }

              card.appendChild(img);

              // Artist name
              const nameDiv = document.createElement("div");
              nameDiv.classList.add("artist-name");
              nameDiv.textContent = artist.name || "Unknown Artist";
              card.appendChild(nameDiv);

              // When a card is clicked, fetch and display artist details
              card.addEventListener("click", () => {
                detailsPanel.style.display = "none";
                loading.style.display = "block";

                // Update selected styling:
                if (currentSelectedCard) {
                  currentSelectedCard.classList.remove("selected");
                }
                currentSelectedCard = card;
                card.classList.add("selected");

                fetch("/artist/" + encodeURIComponent(artist.id))
                  .then((resp) => resp.json())
                  .then((details) => {
                    loading.style.display = "none";
                    detailsPanel.style.display = "block";

                    // Combine name + birth/death dates in one line
                    const name = details.name || "Unknown Artist";
                    const birth = details.birthday || "";
                    const death = details.deathday || "";

                    let nameWithDates = name;
                    if (birth && death) {
                      nameWithDates += ` (${birth} - ${death})`;
                    } else if (birth) {
                      nameWithDates += ` (${birth})`;
                    } else if (death) {
                      nameWithDates += ` (${death})`;
                    }

                    detailsName.textContent = nameWithDates;
                    detailsNationality.textContent =
                      details.nationality || "";
                    detailsBio.textContent =
                      details.biography || "No biography available.";
                  })
                  .catch((err) => {
                    console.error("Error fetching details:", err);
                    loading.style.display = "none";
                    detailsPanel.style.display = "block";
                    detailsName.textContent = "Error loading details.";
                    detailsNationality.textContent = "";
                    detailsBio.textContent = "";
                  });
              });

              resultsContainer.appendChild(card);
            });
          })
          .catch((error) => {
            console.error("Error fetching search results:", error);
            loading.style.display = "none";
            noResultsDiv.style.display = "block";
          });
      });
    </script>
  </body>
</html>
